---
title: "Two Sample Mendelian Randomization on Longevity GWAS"
author: "Christine Le"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  rmdformats::material
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(VennDiagram)
library(reactable)
library(tidyverse)

#data



Pilling_dat <- readRDS("data/MR/Pilling_multtest_F.rds")
Timmers_dat <- readRDS("data/MR/Timmers_multtest_F.rds")
Cases90_dat <- readRDS("data/MR/Cases90_multtest_F.rds")
Cases99_dat <- readRDS("data/MR/Cases99_multtest_F.rds")



```


# Background

```{r agingfig}
knitr::include_graphics("images/An_Aging_Nation.png")
```

# Motivation

```{r twomr, out.width= "50%"}
knitr::include_graphics("images/General_DAG.png")
```

**Longevity is complex**
  
  - Confounding makes finding true associations difficult
  
**Solution** : Two Sample Mendelian Randomization

 - use two datasets from similar populations
 
 - provide strong evidence of the true relationship between longevity and certain exposures

# Methods

```{r twomrfig, out.width= "50%"}
knitr::include_graphics("images/2MR.png")
```


**Two Sample Mendelian Randomization**

- Exposure: SNPs as a proxy for Exposure from one dataset
- Outcome: outcome from another dataset using SNPs from Exposure to assess the causal relationship between Exposure and Outcome, bypassing confounders that influence the E-O relationship.

**Advantages**

  - readily available data
  
  - simple analyses
  
  - cost-efficient


# Assumptions 

```{r assumptions, out.width= "50%"}
knitr::include_graphics("images/2MR.png")
```

**Assumption 1** : The first assumption is that SNPs are truly associated with Exposure

**Assumption 2** : No Horizontal Pleiotropy

**Assumption 3** : SNPs not associated with E-O confounders

# Assumption # 1 

**Assumption 1**

```{r assumption1, out.width= "50%"}
knitr::include_graphics("images/2MR.png")
```

**Assumption 1** : The first assumption is that SNPs are truly associated with Exposure, as seen from independent studies

- limit exposures which are significantly associated with SNPs from other GWAS studies


# Assumption # 2  

**Assumption 2**

```{r assumption2, out.width= "50%"}
knitr::include_graphics("images/2MR.png")
```

**Assumption 2** : No Horizontal Pleiotropy

- SNPs are associated with outcome through Exposure only

# Assumption # 3  

**Assumption 3**

```{r assumption3, out.width= "50%"}
knitr::include_graphics("images/2MR.png")
```

**Assumption 3** : SNPs not associated with E-O confounders


 - the lack of confounders is partly what allows us assume that the randomness of allele inheritance is equivalent to random assignment in an RCT



# Violations of Assumptions

**Weak Instruments** : when the SNP is not strongly associated with the exposure

  - low power
  - bias association towards the null
  
**Horizontal Pleiotropy** : refers to the effects of the SNPs on the outcome not mediated by the exposure

  - when a SNP is related to multiple traits independent of the exposure  
  
    - requires adjusted methods to estimate our association of interest even when present 



# Methods for Determining Estimates Overview

```{r}
knitr::include_graphics("images/LD.png")
```

**LD Clumping**

  - clump SNPs that are close to each other



**Inverse Variance Weighted**

- simplest method to calculate the MR estimate

- requires all assumptions of the model to be med

**Egger**

- estimates are unbiased in the presence of horizontal pleiotropy
   
    - suffers from low power
    
    - weak instruments can influence the regression and therefore the estimate


**Median Weighted**

- estimates are unbiased for up to 50% weak or invalid instruments



# TWoSampleMR Package

**Software- TwoSampleMR Package**

R package developed to utilize 2-sample Mendelian Randomization on GWAS studies with curated databases. 
Allows researchers to more easily perform 2-sample Mendelian Randomization on GWASs to discover and eludicate possible causal relationships between phenotypes and evaluate assumptions of this statistical strategy. 

source: Gibran Hemani, Jie Zheng, Kaitlin H Wade, Charles Laurin, Benjamin Elsworth, Stephen Burgess, Jack Bowden, Ryan Langdon, Vanessa Tan, James Yarmolinsky, Hashem A. $ The MR-Base platform supports systematic causal inference across the human phenome. eLife 2018. doi: https://doi.org/10.7554/eLife.34408 

# Detecting Violations

**Heterogeneity** : estimates are not consistent across independent instruments

- suggests that an assumption is being violated

  - difficult to detect
  
  - possible causes : horizontal pleiotopy, non-homogenous underlying populations in the study, weak instruments
  
- TwoSampleMR package: use mr_heterogeneity() function

  - Q statistic :
    - review definition
    - will perform a test of heterogeneity on harmonized data
  
    
Horizontal Pleiotropy

**Horizontal Pleiotropy** : refers to the effects of the SNPs on the outcome not mediated by the exposure

- TwoSampleMR: use mr_pleiotropy_test()
   - if significant,  there is the presence of horizontal pleiotropy 

      

**SNPs associated with E-O confounders**  

- difficult to prove positively to due complex biological pathways and unknown confounded

- can be tested with known confounded of the Exposure-Outcome relationship

**Scatter plot** 

  - can evaluate whether there are outliers in the IV estimates

# Solutions

**Weak Instruments**

- Use Median Weighted Estimation Method
  - only have of the SNPs need to meet the assumptions above
  
**horizontal pleiotropy**

- Use Egger Estimation Method
  - MR Egger method would result in a better estimate than IVW



# Other Limitations

**developmenal compensation /canalization**

   - solution: careful interpretation of results, realizing that both environmental and genetic factors influence an outcome.
   
   - bias towards null
   
**collider bias**

  - be careful in how we interpret the results of our analysis. Based on current knowledge could the relationship we see in our study be due to other biases like loss to follow up.


# Data Description - Exposures
Data obtained using IEU GWAS database

**GWAS **
Curated from the NHGRI-EBI GWAS Catalog of significant associations found in different GWAS studies to include only data that has the required information to perform MR analyis. Catalog was further cleaned so that the unit of report is the same.

**Proteins**

Significant associations from GWAS studies on 47 protein levels obtained from whole blood

**Metabolites**

Database of significant associations on 121 metabolites from GWAS studies provided by Peter Wurtz and Mika Ala-Korpela. 

**Genes**

Signficant associations of tissue-specific gene expression  GWASs from the GTEX study. 


**Methylation**

Significant hits from GWASs on DNA methylation levels performed on mothers and children, with five timepoints during the lifecourse (e.g. child - birth, child - childhood, child - adolescence, mother - pregnancy, mother - middle age).


# Data Description - Outcomes

**Pilling**
Results from GWAS study of parental longevity (combined monther's and father's age) on UK Biobank participants. Participants whose parental longevity was in the top 10 percent were compared with all other UK Biobank participants who met the inclusion criteria. 

**Timmers**
GWAS results from 1 million parental lifespans of 500,000 particpants with data on mortalilty risk factors. 

**Deleen**


# Results - Pilling
Table 1. Significant Results (adjusted p-value $\leq$ 0.05) for Longevity as Defined by Pilling
```{r}
table1_Groups <- c("Cardiovascular Drug", "Cardiovascular Outcome", "Cardiovascular Drug", "Parental Longevity", "Cardiovascular Outcome",  "Cardiovascular Risk Factors",  "Cardiovascular Risk Factors" , "Smoking", "Neurological",  "Cardiovascular Risk Factors", "Neurological",  "Cardiovascular Risk Factors",  "Cardiovascular Outcome", "Cardiovascular Risk Factors" ,   "Cardiovascular Risk Factors"  , "Neurological",  "Cardiovascular Risk Factors" , "Smoking", "Other",   "Cardiovascular Drug" ,  "Cardiovascular Risk Factors" ,  "Cardiovascular Risk Factors" ,"Neurological","Cardiovascular Risk Factors",  "Cardiovascular Risk Factors" ,  "Cardiovascular Outcome" ,  "Cardiovascular Risk Factors",  "Cardiovascular Outcome", "Cardiovascular Drug", "Other",  "Cardiovascular Outcome" )
table1 <- readRDS("data/MR/Pilling_multtest_F.rds")%>%
  filter(method == "Inverse variance weighted", pval_BH < 0.05) %>%
  select(-id.exposure, -id.outcome, -outcome, -method) %>%
  mutate(Groups = table1_Groups)
  

#create groups


##make a table
reactable(table1,bordered = TRUE, groupBy = "Groups", columns = list(
    exposure = colDef(name = "Exposure", filterable = TRUE),
    exposure_dat = colDef(name = "Exposure Dataset"),
    pval_BH = colDef(name = "BH Adjusted p-value", format = colFormat(digits = 5)),
    b = colDef(format = colFormat(digits = 5)),
    se = colDef(format = colFormat(digits = 5)),
    pval = colDef(format = colFormat(digits = 5))
  ))
  
```



# Results - Timmers

Table 2. Significant Results (adjusted p-value $\leq$ 0.05) for Longevity as Defined by Timmers

```{r, out.width= "50%"}
table2_Group <- c(
"Cardiovascular Drug", 
"Cardiovascular Risk Factors", 
"Cardiovascular Drug" , 
"Asthma",   
"Cardiovascular Risk Factors", 
"Cancer",
"Neurological", 
"Cardiovascular Risk Factors" ,
"Neurological" ,  
"Cardiovascular Outcome" , 
"Urinary albumin excretion (unit increase)", 
"Homocysteine levels (unit increase)",  
"Cardiovascular Drug", 
"Cardiovascular Risk Factors" ,
"Cardiovascular Risk Factors" , 
"Multiple keratinocyte cancers (NR z-score increase)" ,
"Smoking" ,
"Cardiovascular Risk Factors",  
"Cardiovascular Risk Factors", 
"Parental longevity (combined parental attained age, Martingale residuals) (unit decrease)" , 
"Neurological" , 
"Cardiovascular Risk Factors" , 
"Neurological" , 
"Smoking" , 
"Sunburns (unit increase)" , 
"Cardiovascular Outcome", 
"Carotid intima media thickness (unit increase)"  ,
"Smoking status (ever vs never smokers) (unit increase)", 
"Smoking status (ever vs never smokers) (unit decrease)", 
"Cardiovascular Risk Factors" ,  
"Cardiovascular Risk Factors" , 
"Neurological",
"Squamous cell lung carcinoma", 
"Cardiovascular Drug" ,  
"Cardiovascular Risk Factors" , 
"Cardiovascular Risk Factors" , 
"Sleep time (unit decrease)", 
"Neurological",
"Cardiovascular Risk Factors" , 
"Cardiovascular Risk Factors"   , 
"Cardiovascular Risk Factors"   ,
"Cigarettes smoked per day (MTAG) (unit increase)" , 
"Lipoprotein(a) levels adjusted for apolipoprotein(a) isoforms (unit increase)" , 
"Neurological" , 
"Cardiovascular Risk Factors"  ,
"Parental lifespan (years decrease)" ,
"Parental longevity (combined parental attained age, Martingale residuals) (unit increase)",
"Neurological" , 
"Type 2 diabetes (unit increase)"  ,
"Cardiovascular Risk Factors"  ,
"Neurological",
"Neurological",
"Neurological",
"Cardiovascular Risk Factors" ,
"Age of smoking initiation (MTAG) (unit decrease)", 
"Cardiovascular Risk Factors"   ,
"Cardiovascular Risk Factors"  ,
"General cognitive ability (z-score decrease)" ,
"Cardiovascular Risk Factors"  ,
"Parental longevity (both parents in top 10%) (unit increase)" ,
"Lipoprotein phospholipase A2 activity in cardiovascular disease (nmol/min/ml) increase)" ,
"Well-being spectrum (multivariate analysis) (unit increase)", 
"RANTES levels (SD units decrease)" ,
"Cardiovascular Risk Factors"  ,   
"Cardiovascular Risk Factors"   ,
"Smoking initiation (ever regular vs never regular) (unit increase)" ,
"Alcohol use disorder (NR z score increase)" ,
"Smoking initiation (ever regular vs never regular) (unit decrease)",
"Cardiovascular Risk Factors" ,
"Medication use (antithrombotic agents) (unit decrease)" ,
"Neurological"  ,
"Cardiovascular Risk Factors"  ,
"Cardiovascular Risk Factors"  ,
"Cardiovascular Risk Factors"  ,
"Neurological"  , 
"Cardiovascular Risk Factors"  , 
"Phosphorus levels (mg/dl decrease)",
"Cardiovascular Outcome"  ,
"Activated partial thromboplastin time (unit increase)"  ,
"Cardiovascular Risk Factors"  ,
"Breast cancer (unit increase)" ,   
"Neurological"   ,
"Cardiovascular Risk Factors"  ,
"Cardiovascular Risk Factors" ,
"Cardiovascular Risk Factors"   ,
"Lipoprotein-associated phospholipase A2 activity and mass (nmol/ml/min increase)" ,
"Smoking initiation (ever regular vs never regular) (MTAG) (unit increase)", 
"Cardiovascular Risk Factors" ,
"Cardiovascular Risk Factors" , 
"Cardiovascular  Outcome" ,
"Cardiovascular Risk Factors" ,
"Neurological" , 
"Cardiovascular Risk Factors" ,
"Lung cancer" ,                    
"Cardiovascular Risk Factors" ,
"Cardiovascular Risk Factors"  ,
"Cardiovascular Risk Factors)"  ,
"Idiopathic pulmonary fibrosis"  ,
"Neurological" ,
"Neurological",
"Cardiovascular Risk Factors"   , 
"N-glycan levels (zscore) increase)",
"Iron status biomarkers (total iron binding capacity) (unit increase)" ,
"Smoking",
 "Cardiovascular Risk Factors" , 
 "Cardiovascular Risk Factors" ,
 "Cardiovascular Risk Factors"   ,
 "Cardiovascular Outcome" ,
"General cognitive ability (z-score increase)" ,
 "Neurological"    ,
"Cardiovascular Risk Factors" ,
"Neurological",
"Cardiovascular Risk Factors" ,    
"Parental longevity (father's age at death) (unit increase)",
"Cardiovascular Risk Factors", 
"Cardiovascular Risk Factors",
"Cardiovascular Risk Factors"  , 
"Smoking",
 "Regular attendance at a pub or social club (unit decrease)",
"Cardiovascular Drug" ,
 "Rheumatoid arthritis (NA)",
"Menopause (age at onset) (year increase)",
 "Breast cancer (Oncoarray)" ,
 "Neurological" ,
"Iron status biomarkers (ferritin levels) (unit increase)",
"Medication use (salicylic acid and derivatives) (unit increase)",
"Cardiovascular Risk Factors" ,
"Cardiovascular Risk Factors" ,
"Neurological" ,
"Neurological" ,
"Parental longevity (combined parental age at death) (unit increase)",
"Parental longevity (mother's age at death) (unit increase)",
"Cardiovascular Drug",
"Smoking" ,
"Cardiovascular Risk Factors",
"Cardiovascular Risk Factors",    
"Fibrinogen (g/L increase)" ,
"Neurological",
"Neurological",
"Hand grip strength (unit increase)" ,
"Cardiovascular Risk Factors",
"Cardiovascular Risk Factors",
"Parental longevity (father's attained age) (unit decrease)" ,
"Cardiovascular Risk Factors",
"Smoking",
"Acute kidney injury in coronary artery bypass surgery (creatinine rise)" ,
"Cardiovascular Outcome",
"Neurological",
"Cardiovascular Risk Factors",
"Neurological",
"Cardiovascular Risk Factors" ,
"Cardiovascular Outcome",
"Cardiovascular Risk Factors",
"Cardiovascular Risk Factors"  ,
"Cardiovascular Risk Factors" ,
"Age at first sexual intercourse",
"Cardiovascular Drug",
"Medication use (salicylic acid and derivatives) (unit decrease)" ,
"Smoking",
"Cardiovascular Risk Factors"  ,
"Smoking",
"Cardiovascular Risk Factors" ,
"Cardiovascular Risk Factors",
"Intelligence (z-score decrease)" ,
"Cardiovascular Drug" ,
"Cardiovascular Drug" ,
"Cerebrospinal fluid AB1-42 levels (unit decrease)",
"Cardiovascular Risk Factors",
"Cardiovascular Risk Factors",
"Cardiovascular Drug",
"Neurological" ,
"Cardiovascular Risk Factors",
"Self-reported math ability (unit decrease)",
"Cardiovascular Risk Factors" ,
"Smoking",
"Cardiovascular Outcome" , 
 "Neurological",
"Cardiovascular Risk Factors" ) 

table2 <- readRDS("data/MR/Timmers_multtest_F.rds")%>%
  filter(method == "Inverse variance weighted", pval_BH < 0.05) %>%
  select(-id.exposure, -id.outcome, -outcome, -method) %>%
  mutate(Groups = table2_Group)

reactable(table2, bordered = TRUE, groupBy = "Groups", columns = list(
    exposure = colDef(name = "Exposure", filterable = TRUE),
    exposure_dat = colDef(name = "Exposure Dataset"),
    pval_BH = colDef(name = "BH Adjusted p-value", format = colFormat(digits = 5)),
    b = colDef(format = colFormat(digits = 5)),
    se = colDef(format = colFormat(digits = 5)),
    pval = colDef(format = colFormat(digits = 5))
  ))
  
```



# Results - Deleen Cases 90

Table 3. Significant Results (adjusted p-value $\leq$ 0.05) for Longevity as Defined by Deleen 90th Percentile


```{r}

table3_Group <- c(
"Cardiovascular Drug",                                                                                                                                
 "Longevity (85 years and older)",                                                                                                                                           
"Cardiovascular Drug",                                                                                                             
"Cardiovascular Risk Factors",                                                                                                                                 
"Cardiovascular Outcome",                                                                                                                                 
"Thyroid peroxidase antibody levels"  ,                                                                                                                                      
"Cardiovascular Drug",                                                                                                            
"Cardiovascular Risk Factors",                                                                                                                                        
"Cardiovascular Risk Factors",                                                                                   
"Parental longevity (combined parental attained age, Martingale residuals) (unit decrease)",                                                                                 
"Cardiovascular Risk Factors",                                                                                                                                
"Cardiovascular Outcome",                                                                                                                                  
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Drug",                                                                                                                    
"Cardiovascular Risk Factors",                                                                                                                                  
 "Total hippocampal volume (NR mm3 decrease)",                                                                                                                               
"Cardiovascular Risk Factors",                                                                                                                                
"Smoking",                                                                                                                       
"Cardiovascular Risk Factors",                                                                                                                                         
"Cardiovascular Risk Factors",                                                                                                                                                            
"Smoking",                                                                                                                         
"Cardiovascular Risk Factors",                                                                                                                                
"Cardiovascular Risk Factors",                                                                                                                                         
 "Parental longevity (both parents in top 10%) (unit increase)"  ,                                                                                                            
"Cardiovascular Risk Factors",                                                                                 
"Cardiovascular Risk Factors",                                                                                                                                            
"Cardiovascular Risk Factors",                                                                                                                                      
"Cardiovascular Risk Factors",                                                                                                                                   
 "Educational attainment (years of education) (unit decrease)"  ,                                                                                                             
 "Alzheimer's disease or family history of Alzheimer's disease (NR z-unit decrease)"   ,                                                                                      
"Smoking",                                                                                                 
"Cardiovascular Outcome",
"Cardiovascular Risk Factors",                                                                                                                                      
"Cardiovascular Risk Factors",                                                                                                                                               
"Cardiovascular Risk Factors",                                                                                                               
"Cardiovascular Risk Factors",                                                                                                                     
"Cardiovascular Risk Factors",                                                                                                                                                      
"Cardiovascular Drug",                                                                                         
"Medication use (salicylic acid and derivatives) (unit increase)"  ,                                                                                                         
"Dementia and core Alzheimer's disease neuropathologic changes (unit increase)"  ,                                                                                           
 "Dentate gyrus molecular layer volume (NR mm3 decrease)"   ,                                                                                                                 
"Cardiovascular Risk Factors",                                                                                                                                            
"Cardiovascular Drug",                                                                                                                    
"Alzheimer's disease or family history of Alzheimer's disease (NR z-unit increase)"   ,                                                                                      
"Cardiovascular Risk Factors",                                                                                                                                     
"Cardiovascular Risk Factors",                                                                                                                                   
"Cardiovascular Risk Factors",                                                                                                                             
 "Medication use (antithrombotic agents) (unit increase)" ,                                                                                                                   
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Risk Factors",                                                                                                                                          
"Cardiovascular Risk Factors",                                                                                                                                 
"Cardiovascular Drug",                                                                                                                                
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Drug",                                                                                                                 
"Cardiovascular Drug",                                                                                                               
"Cerebrospinal fluid AB1-42 levels (unit decrease)"   ,                                                                                                                      
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Drug",                                                                                            
 "Family history of Alzheimer's disease (NR z-score increase)"   ,                                                                                                            
"Cardiovascular Risk Factors",                                                                                                                                 
"Cardiovascular Outcome",                                                                                                                                              
"Cardiovascular Risk Factors",                                                                                                                                           
 "Lipids"   ,                                                                                                                                                                  
"Lipids"     ,                                                                                                                                                           
 "Lipids "    ,                                                                                                                                                               
 "Lipids"     ,                                                                                                                                                            
 "Lipids "     ,                                                                                                                                                             
 "Lipids "     ,                                                                                                                                              
"Lipids " ,                                                                                                                                                                 
"Lipids " ,                                                                                                                                                                    
 "Lipids"  ,                                                                                                                                                                  
 "Lipids" ,                                                                                                                                                                    
 "Lipids" ,                                                                                                                                                                
 "Lipids",                                                                                                                                                                   
 "Lipids",                                                                                                                                                                   
"Lipids "  ,                                                                                                                                                                  
 "Lipids",                                                                                                                                                                   
 "Lipids"  ,                                                                                                                                                                   
"Lipids" ,                                                                                                                                                                     
"Lipids"  ,                                                                                                                                                                 
"Lipidsl" ,                                                                                                                                                                   
 "Lipids " ,                                                                                                                                                                  
"Lipids" ,                                                                                                                                                                  
"Lipids" ,                                                                                                                                                                 
"Lipids"  ,                                                                                                                                                                   
"Lipids" ,                                                                                                                                                                 
"Lipids"  ,                                                                                                                                                                    
"Lipids"  ,                                                                                                                                                                 
 "Lipids"  ,                                                                                                                                                                 
"Lipids" ,                                                                                                                                                                 
"Lipids"    ,                                                                                                                   

"Lipids"      
)
table3 <- readRDS("data/MR/Cases90_multtest_F.rds")%>%
  filter(method == "Inverse variance weighted", pval_BH < 0.05) %>%
  select(-id.exposure, -id.outcome, -outcome, -method) %>%
  mutate(Groups = table3_Group)

reactable(table3, bordered = TRUE, groupBy = "Groups" ,columns = list(
    exposure = colDef(name = "Exposure", filterable = TRUE),
    exposure_dat = colDef(name = "Exposure Dataset"),
    pval_BH = colDef(name = "BH Adjusted p-value", format = colFormat(digits = 5)),
    b = colDef(format = colFormat(digits = 5)),
    se = colDef(format = colFormat(digits = 5)),
    pval = colDef(format = colFormat(digits = 5))
  ))
  
```

# Results - Deleen Cases 99

Table 4. Significant Results (adjusted p-value $\leq$ 0.05) for Longevity as Defined by Deleen: 99th Percentile


```{r}
table4_Groups <- c(
"Cardiovascular Drug",                                                                                                                             
"Longevity (85 years and older)"  ,                                                                                                                                          
"Cardiovascular Drug",                                                                                                           
"Cardiovascular Outcome",                                                                                                                                  
"Cardiovascular Drug",                                                                                                           
"Cardiovascular Risk Factors",                                                                                                                                 
"Cardiovascular Outcome",                                                                                                                                 
"Smoking"    ,                                                                                                                
"Cardiovascular Risk Factors",                                                                                                                                       
"Cardiovascular Risk Factors",                                                                                                                                             
"Cardiovascular Risk Factors",                                                                                                                                                             
"Smoking"    ,                                                                                                                          
"Parental longevity (both parents in top 10%) (unit increase)"     ,                                                                                                         
"Cardiovascular Risk Factors",                                                                                                                                         
"Cardiovascular Outcome",                                                                                                                                        
"Cardiovascular Risk Factors",    
"Cardiovascular Risk Factors", 
"Cardiovascular Drug",                                                                                           
 "Dementia with Lewy bodies"  ,                                                                                                                                               
 "Dementia and core Alzheimer's disease neuropathologic changes (unit increase)"  ,                                                                                           
"Cardiovascular Drug",                                                                                                                  
 "Alzheimer's disease or family history of Alzheimer's disease (NR z-unit increase)"  ,                                                                                      
"Cardiovascular Risk Factors",                                                                                                                                     
"Cardiovascular Risk Factors",                                                                                                                                              
"Cardiovascular Drug",                                                                                                                               
"Cardiovascular Drug",                                                                                                                
"Cerebrospinal fluid AB1-42 levels (unit decrease)"       ,                                                                                                                  
"Cardiovascular Drug",                                                                                          
"Family history of Alzheimer's disease (NR z-score increase)"    ,                                                                                                           
 "Lipids"   ,                                                                                                                                                                  
 "Lipids"   ,                                                                                                                                                             
"Lipids"  ,                                                                                                                                                                 
"Lipids" ,                                                                                                                                                                
 "Lipids"  ,                                                                                                                                                                
"Lipids "   ,                                                                                                                                                                
"Lipids"  ,                                                                                                                                                                
"Lipids" ,                                                                                                                                                                    
 "Lipids"    ,                                                                                                                                                                
"Lipids"       ,                                                                                                                                                              
 "Lipids"    ,                                                                                                                                                               
 "Lipids",                                                                                                                                                                   
 "Lipids"  ,                                                                                                                                                                 
 "Lipids" ,                                                                                                                                                                    
 "Lipids" ,                                                                                                                                                                     
"Lipids"   ,                                                                                                                                                                 
 "Lipids" ,                                                                                                                                                                   
 "Lipids "  ,                                                                                                                                                                 
"Lipids" ,                                                                                                                                                                  
 "Lipids " ,                                                                                                                                                                 
 "Lipids",                                                                                                                                                                     
"Lipids" ,                                                                                                                                                                 
"Lipids" ,                                                                                                                                                                  
"Lipids",                                                                                                                                                                   
 "Lipids" ,                                                                                                                                                                 
 "Lipids"  )
table4 <- readRDS("data/MR/Cases99_multtest_F.rds")%>%
  filter(method == "Inverse variance weighted", pval_BH < 0.05) %>%
  select(-id.exposure, -id.outcome, -outcome, -method)%>%
  mutate(Groups = table4_Groups)

reactable(table4, bordered = TRUE,groupBy = "Groups", columns = list(
    exposure = colDef(name = "Exposure", filterable = TRUE),
    exposure_dat = colDef(name = "Exposure Dataset"),
    pval_BH = colDef(name = "BH Adjusted p-value", format = colFormat(digits = 5)),
    b = colDef(format = colFormat(digits = 5)),
    se = colDef(format = colFormat(digits = 5)),
    pval = colDef(format = colFormat(digits = 5))
  ))
  
```



# Common and Unique Exposures in Each Study - Venn Diagram





```{r, eval=FALSE}
venn.diagram(
  x = list(
    Pilling_dat %>% 
      filter(method == "Inverse variance weighted", pval_BH <= 0.05, exposure_dat != "methylation") %>% 
      select(exposure) %>% unlist(),
    Timmers_dat %>% 
      filter(method == "Inverse variance weighted", pval_BH <= 0.05) %>% 
      select(exposure) %>% unlist(),
    Cases90_dat %>% 
      filter(method == "Inverse variance weighted", pval_BH <= 0.05) %>% 
      select(exposure) %>% unlist(),
    Cases99_dat %>% 
      filter(method == "Inverse variance weighted", pval_BH <= 0.05) %>% 
      select(exposure) %>% unlist()
  ),
  category.names = c("Pilling", "Timmers", "Deleen 90th", "Deleen 99th"),
  filename = "images/FourOutcomesVenn.png",
  output = TRUE,
          imagetype="png" ,
          height = 900 , 
          width = 1200 , 
          resolution = 300,
          compression = "lzw",
          lwd = 1,
          col=c("#440154ff", '#21908dff', '#fde725ff', '#ff3374'),
          fill = c(alpha("#440154ff",0.3), alpha('#21908dff',0.3), alpha('#fde725ff',0.3), alpha('#ff3374', 0.3))

  
)
```
```{r, out.width = "50%"}
knitr::include_graphics("images/FourOutcomesVenn.png")
```


For exposures with adjusted p-values less than or equal to 0.05

- no common exposures among Pilling, cases90 & cases 99 

- no common exposures among pilling & cases 99

- no common exposures among pilling , timmers and cases 99

# Results - Table


```{r, out.width="50%"}

#Create a table containing adjusted p-values and informationon exposure dataset, and outcome dataset sources
PillingA <- Pilling_dat %>% 
  filter(method == "Inverse variance weighted", exposure_dat != "methylation") %>%
  mutate(Pilling = "Yes") %>%
  rename(Exposure.Dataset.Pilling = exposure_dat, Adjusted.p.Pilling = pval_BH, 
         b.pilling = b, se.pilling = se, nsnp.pilling = nsnp, pval.pilling = pval ) %>% 
  select(-id.exposure, -id.outcome, -outcome, -method) 
TimmersA <- Timmers_dat %>% 
  filter(method == "Inverse variance weighted") %>%
  mutate(Timmers = "Yes") %>%
  rename(Exposure.Dataset.Timmers = exposure_dat, Adjusted.p.Timmers = pval_BH, 
         b.timmers = b, se.timmers = se, nsnp.timmers = nsnp, pval.timmers = pval) %>% 
  select(-id.exposure, -id.outcome, -outcome, -method) 
Cases90A <- Cases90_dat %>%
  filter(method == "Inverse variance weighted") %>%
  mutate(Cases90 = "Yes") %>%
  rename(Exposure.Dataset.Cases90 = exposure_dat, Adjusted.p.Cases90 = pval_BH, 
         b.90 = b, se.90 = se, nsnp.90 = nsnp, pval.90 = pval) %>% 
  select(-id.exposure, -id.outcome, -outcome, -method)
Cases99A <- Cases99_dat %>%
  filter(method == "Inverse variance weighted") %>%
  mutate(Cases99 = "Yes") %>%
  rename(Exposure.Dataset.Cases99 = exposure_dat, Adjusted.p.Cases99 = pval_BH,
         b.99 = b, se.99 = se, nsnp.99 = nsnp, pval.99 = pval) %>% 
  select(-id.exposure, -id.outcome, -outcome, -method)

dat_all <- merge(TimmersA, PillingA, by = "exposure", all = TRUE)
dat_all <- merge(dat_all, Cases90A, by = "exposure", all = TRUE)
dat_all <- merge(dat_all, Cases99A, by = "exposure", all = TRUE)


#replace NAs in Dataset columns with "NO"

dat_all$Pilling <- ifelse(is.na(dat_all$Pilling), "NO", "YES")
dat_all$Timmers <- ifelse(is.na(dat_all$Timmers), "NO", "YES")
dat_all$Cases90 <- ifelse(is.na(dat_all$Cases90), "NO", "YES")
dat_all$Cases99 <- ifelse(is.na(dat_all$Cases99), "NO", "YES")



#Make one Exposure Dataset column

dat_all$Exposure.Dataset <- ifelse(dat_all$Pilling == "YES", dat_all$Exposure.Dataset.Pilling,
                               ifelse(dat_all$Timmers == "YES", dat_all$Exposure.Dataset.Timmers,
                                      ifelse(dat_all$Cases90 == "YES", dat_all$Exposure.Dataset.Cases90,
                                             ifelse(dat_all$Cases99 == "YES", dat_all$Exposure.Dataset.Cases99, NA)
                                             )
                                      )
                               )
#remove extra exposure dataset columns
dat <- dat_all
dat <- dat %>%
 select(exposure, Pilling, Timmers, Cases90, Cases99, Adjusted.p.Pilling, Adjusted.p.Timmers, Adjusted.p.Cases90, Adjusted.p.Cases99, Exposure.Dataset)


#save results for future use

saveRDS(dat, "results/results_201908.rds")
saveRDS(dat_all, "results/full_results_201908.rds")
```
Table 1. Any Significant Exposures (adjusted p-value $\leq$ 0.05) among any sleniumFour Outcomes who are  using the Inverse Variance Weighted Method*

*empty cells represent missing data

```{r, out.width="50%"}

#create a filterable table
tableone <- filter(dat_all, Adjusted.p.Timmers <= 0.05 | Adjusted.p.Cases90 <= 0.05 | Adjusted.p.Cases99 <= 0.05 | Adjusted.p.Pilling <=0.05) %>%
  select(exposure, Pilling, Timmers, Cases90, Cases99, Adjusted.p.Pilling, Adjusted.p.Timmers, Adjusted.p.Cases90, Adjusted.p.Cases99, Exposure.Dataset)
reactable(tableone, filterable = TRUE, paginationType = "jump", showSortable = TRUE, bordered = TRUE,
          columns = list( 
            exposure = colDef(name = "Exposure"),
            Adjusted.p.Timmers = colDef(name = "Adjusted p-value (Timmers)", 
                                        align = "center", headerStyle = list(background = "#f7f7f8"),
                                        filterable = FALSE, format = colFormat(digits = 5)),         
            Adjusted.p.Pilling = colDef(name = "Adjusted p-value (Pilling)", 
                                        align = "center",headerStyle = list(background = "#f7f7f8"),
                                        filterable = FALSE, format = colFormat(digits = 5)),
            Adjusted.p.Cases90 = colDef(name = "Adjusted p-value (Cases90)", 
                                   align = "center",headerStyle = list(background = "#f7f7f8"),
                                   filterable = FALSE, format = colFormat(digits = 5)),
            Adjusted.p.Cases99 = colDef(name = "Adjusted p-value (Cases99)", 
                                   align = "center",headerStyle = list(background = "#f7f7f8"),
                                   filterable = FALSE, format = colFormat(digits = 5)),
            Exposure.Dataset = colDef(name = "Exposure Dataset", 
                                              align = "center",headerStyle = list(background = "#f7f7f8")),
            Pilling = colDef(name = "Pilling", cell = function(value){
              if(value == "NO") "\u2718" else "\u2713"
            }),
            Timmers = colDef(cell = function(value){
              if(value == "NO") "\u2718" else "\u2713"
            }),
            Cases90 = colDef(name = "90th Percentile", cell = function(value){
              if(value == "NO") "\u2718" else "\u2713"
            }),
            Cases99 = colDef(name = "99th Percentile", cell = function(value){
              if(value == "NO") "\u2718" else "\u2713"
            })
          ))
```






# Common Exposures - All four datasets

Table 5 Common Exposures Among All Four Outcomes
```{r}

table5 <-dat_all %>% filter(Pilling == "YES" & Timmers == "YES" & Cases90 == "YES" & Cases99 == "YES") %>% 
  select(exposure,  b.pilling, se.pilling, pval.pilling, Adjusted.p.Pilling,  b.timmers, se.timmers, pval.timmers, Adjusted.p.Timmers, b.90, se.90, pval.90, Adjusted.p.Cases90, b.99, se.99, pval.99, Adjusted.p.Cases99, Exposure.Dataset)
  # select(exposure, nsnp.pilling, b.pilling, se.pilling, pval.pilling, Adjusted.p.Pilling, nsnp.timmers, b.timmers, se.timmers, pval.timmers, Adjusted.p.Timmers, nsnp.90, b.90, se.90, pval.90, Adjusted.p.Cases90, nsnp.99, b.99, se.99, pval.99, Adjusted.p.Cases99, Exposure.Dataset) %>%
  
reactable(table5, bordered = TRUE, columns = list(
    
            exposure = colDef(name = "Exposure", filterable = TRUE),
            Adjusted.p.Cases90 = colDef(name = "90th Percentile", align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            Exposure.Dataset = colDef(name = "Exposure Dataset",
                                      filterable = TRUE,
                                      align = "center",
                                      headerStyle = list(background = "#f7f7f8")),
            # nsnp.90 = colDef(name = "90th Percentile", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.90 = colDef(name = "90th Percentile", align = "center",
                               headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            se.90 = colDef(name = "90th Percentile", align = "center",
                                headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
             pval.90 = colDef(name = "90th Percentile", align = "center",
                                  headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            Adjusted.p.Cases99 = colDef(name = "99th Percentile", align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.99 = colDef(name = "99th Percentile", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.99 = colDef(name = "99th Percentile", align = "center",
                               headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            se.99 = colDef(name = "99th Percentile", align = "center",
                                headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
             pval.99 = colDef(name = "99th Percentile", align = "center",
                                  headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            Adjusted.p.Timmers = colDef(name = "Timmers", align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.timmers = colDef(name = "Timmers", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.timmers = colDef(name = "Timmers", align = "center",
                               headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            se.timmers = colDef(name = "Timmers", align = "center",
                                headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
             pval.timmers =colDef(name = "Timmers", align = "center",
                                  headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            Adjusted.p.Pilling = colDef(name = "Pilling", align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.pilling = colDef(name = "Pilling", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.pilling = colDef(name = "Pilling", align = "center",
                               headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
             pval.pilling =colDef(name = "Pilling", align = "center",
                                 headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            
            se.pilling = colDef(name = "Pilling", align = "center",
                                headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5))
  ),
  
            
          
            columnGroups = list(
              # colGroup(name = "nsnp", columns = c("nsnp.timmers", "nsnp.pilling", "nsnp.90", "nsnp.99")),
              colGroup(name = "Beta", columns = c("b.pilling", "b.timmers", "b.90", "b.99")),
              colGroup(name = "SE", columns = c("se.pilling", "se.timmers", "se.90", "se.99")),
              colGroup(name = "p-value", columns = c("pval.pilling", "pval.timmers", "pval.90", "pval.99")),
              colGroup(name = "Adjusted BH p-value", columns = c("Adjusted.p.Pilling", "Adjusted.p.Timmers", "Adjusted.p.Cases90", "Adjusted.p.Cases99"))
            ))
```

# Shared Exposures Deleen 90th Percentile

Table 6. Significant Exposures (adjusted p-value $\leq$ 0.05) found in Deleen's 90th percentile shared among all four outcomes


```{r}
table6_Group <- c(
"Smoking", 

"Alzheimer's disease or family history of Alzheimer's disease (NR z-unit increase)"   ,                                                                                      
"Cardiovascular Risk Factors",                                                                                                                                                       
"Cardiovascular Risk Factors",                                                                                                                                                 
"Cardiovascular Risk Factors",                                                                                                                                        
"Cardiovascular Risk Factors",                                                                                                                                        
"Smoking", 

"Cardiovascular Outcome", 
"Cardiovascular Outcome",                                                                                                                                 
"Cardiovascular Outcome",                                                                                                                                 
"Cardiovascular Outcome",                                                                                                                                               
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Risk Factors",                                                                                                                                  
 "Educational attainment (years of education) (unit decrease)"  ,                                                                                                             
"Cardiovascular Risk Factors",                                                                                                                                       
"Cardiovascular Risk Factors",                                                                                                                                            
"Cardiovascular Risk Factors",                                                                                                                                            
"Cardiovascular Risk Factors",                                                                                                                
"Cardiovascular Risk Factors",                                                                                                                                    
"Cardiovascular Risk Factors",                                                                                                                                    
"Cardiovascular Drug",                                                                                              
"Cardiovascular Drug",                                                                                             
"Cardiovascular Drug",                                                                                                                       
"Cardiovascular Drug",                                                                                                                       
"Cardiovascular Drug",   
"Cardiovascular Drug",                                                                                                                   
"Cardiovascular Drug",                                                                                                                                  
"Cardiovascular Drug",                                                                                                                                  
"Cardiovascular Drug",                                                                                                                
"Cardiovascular Drug",                                                                                                               
"Cardiovascular Risk Factors",                                                                                                                                                             
 "Parental longevity (combined parental attained age, Martingale residuals) (unit decrease)"    ,                                                                             
"Cardiovascular Risk Factors",                                                                                                                                            
"Smoking", 

"Cardiovascular Risk Factors",                                                                                                                                   
"Cardiovascular Risk Factors",                                                                                                                                   
"Cardiovascular Risk Factors",                                                                                                                                   
"Cardiovascular Risk Factors",                                                                                                                                   
"Cardiovascular Risk Factors",                                                                                                                                    
"Cardiovascular Risk Factors",                                                                                                                                   
"Thyroid peroxidase antibody levels"   ,                                                                                                                                     
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Risk Factors"  )
table6 <- dat_all %>% filter(Pilling == "YES" & Timmers == "YES" & Cases99 == "YES" & Cases90 ==  "YES") %>%
  filter(Adjusted.p.Cases90 <= 0.05 & !is.na(Adjusted.p.Timmers) & !is.na(Adjusted.p.Cases90)&!is.na(Adjusted.p.Cases99)&!is.na(Adjusted.p.Pilling)) %>%
  select(exposure,  b.pilling, se.pilling, pval.pilling, Adjusted.p.Pilling,  b.timmers, se.timmers, pval.timmers, Adjusted.p.Timmers, b.90, se.90, pval.90, Adjusted.p.Cases90, b.99, se.99, pval.99, Adjusted.p.Cases99, Exposure.Dataset) %>%
  mutate(Groups= table6_Group)

reactable(table6, groupBy = "Groups",  bordered = TRUE,
          columns = list(
            exposure = colDef(name = "Exposure",  filterable = TRUE),
            Adjusted.p.Cases90 = colDef(name = "90th Percentile", 
                                        align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            Exposure.Dataset = colDef(name = "Exposure Dataset", 
                                       filterable = TRUE,
                                      align = "center",
                                      headerStyle = list(background = "#f7f7f8")),
            # nsnp.90 = colDef(name = "90th Percentile", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.90 = colDef(name = "90th Percentile", align = "center",
                               headerStyle = list(background = "#f7f7f8"),
                          format = colFormat(digits = 5)),
            se.90 = colDef(name = "90th Percentile", align = "center",
                                headerStyle = list(background = "#f7f7f8"),
                           format = colFormat(digits = 5)),
             pval.90 = colDef(name = "90th Percentile", align = "center",
                                  headerStyle = list(background = "#f7f7f8"),
                              format = colFormat(digits = 5)
                              ),
            Adjusted.p.Cases99 = colDef(name = "99th Percentile", 
                                        align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.99 = colDef(name = "99th Percentile", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.99 = colDef(name = "99th Percentile", align = "center",
                               headerStyle = list(background = "#f7f7f8"),
                          format = colFormat(digits = 5)),
            se.99 = colDef(name = "99th Percentile", align = "center",
                                headerStyle = list(background = "#f7f7f8"),
                           format = colFormat(digits = 5)),
             pval.99 = colDef(name = "99th Percentile", align = "center",
                                  headerStyle = list(background = "#f7f7f8"),
                              format = colFormat(digits = 5)),
            Adjusted.p.Timmers = colDef(name = "Timmers", align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.timmers = colDef(name = "Timmers", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.timmers = colDef(name = "Timmers", align = "center",
                               headerStyle = list(background = "#f7f7f8"),
                               format = colFormat(digits = 5)),
            se.timmers = colDef(name = "Timmers", align = "center",
                                headerStyle = list(background = "#f7f7f8"),
                                format = colFormat(digits = 5)),
             pval.timmers =colDef(name = "Timmers", align = "center",
                                  headerStyle = list(background = "#f7f7f8"),
                                  format = colFormat(digits = 5)),
            Adjusted.p.Pilling = colDef(name = "Pilling", align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.pilling = colDef(name = "Pilling", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.pilling = colDef(name = "Pilling", align = "center",
                               headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
             pval.pilling =colDef(name = "Pilling", align = "center",
                                 headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            
            se.pilling = colDef(name = "Pilling", align = "center",
                                headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5))
  ),
  
            
          
            columnGroups = list(
              # colGroup(name = "nsnp", columns = c("nsnp.timmers", "nsnp.pilling", "nsnp.90", "nsnp.99")),
              colGroup(name = "Beta", columns = c("b.pilling", "b.timmers", "b.90", "b.99")),
              colGroup(name = "SE", columns = c("se.pilling", "se.timmers", "se.90", "se.99")),
              colGroup(name = "p-value", columns = c("pval.pilling", "pval.timmers", "pval.90", "pval.99")),
              colGroup(name = "Adjusted BH p-value", columns = c("Adjusted.p.Pilling", "Adjusted.p.Timmers", "Adjusted.p.Cases90", "Adjusted.p.Cases99"))
            ))
  # rowStyle = function(index) {
  #   if (table3[index, "Adjusted.p.Timmers"] <= 0.05)
  #     list(fontWeight = "bold")
  #   else if(table3[index, "Adjusted.p.Pilling"] <= 0.05)
  #     list(fontWeight = "bold")
  #   else if(table3[index, "Adjusted.p.Cases99"] <= 0.05)
  #     list(fontWeight = "bold")
  # 
  # }
  


```

# Common Exposures Among Deleen 99th Percentile Longevity Outcomes

Table 7. Significant Exposures for 99th Percentile of Longevity (adjusted p-value $\leq$ 0.05) shared among all four outcomes

```{r}
table7_Groups <- c(

"Smoking", 

"Alzheimer's disease or family history of Alzheimer's disease (NR z-unit increase)" ,                                                                                        
"Cardiovascular Risk Factors",                                                                                                                                                     
"Cardiovascular Risk Factors",                                                                                                                                      
"Cardiovascular Outcome",
"Cardiovascular Outcome",                                                                                                                                  
"Cardiovascular Outcome",                                                                                                                                  
"Cardiovascular Risk Factors",                                                                                                                                 
"Cardiovascular Risk Factors",                                                                                                                                      
"Cardiovascular Risk Factors",                                                                                                                                   
"Cardiovascular Drug",                                                                                          
"Cardiovascular Drug",                                                                                          
"Cardiovascular Drug",                                                                                                                   
"Cardiovascular Drug",                                                                                                            
"Cardiovascular Drug",                                                                                                                               
"Cardiovascular Drug",                                                                                                                               
"Cardiovascular Drug",                                                                                                            
"Cardiovascular Drug",                                                                                                             
"Cardiovascular Risk Factors",                                                                                                                                                           
"Cardiovascular Risk Factors",                                                                                                                                            
"Smoking",                                                                                                                    
"Cardiovascular Risk Factors",                                                                                                                                  
"Cardiovascular Risk Factors"  )

table7 <- dat_all %>% filter(Pilling == "YES" & Timmers == "YES" & Cases99 == "YES" & Cases90 ==  "YES") %>%
  filter(Adjusted.p.Cases99 <= 0.05 & !is.na(Adjusted.p.Timmers) & !is.na(Adjusted.p.Cases90)&!is.na(Adjusted.p.Cases99)&!is.na(Adjusted.p.Pilling)) %>%
  select(exposure,  b.pilling, se.pilling, pval.pilling, Adjusted.p.Pilling,  b.timmers, se.timmers, pval.timmers, Adjusted.p.Timmers, b.90, se.90, pval.90, Adjusted.p.Cases90, b.99, se.99, pval.99, Adjusted.p.Cases99, Exposure.Dataset) %>%
  mutate(Groups = table7_Groups)

reactable(table7, bordered = TRUE, groupBy = "Groups",
          columns = list(
            exposure = colDef(name = "Exposure",  filterable = TRUE),
            Adjusted.p.Cases90 = colDef(name = "90th Percentile", 
                                        align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            Exposure.Dataset = colDef(name = "Exposure Dataset",
                                       filterable = TRUE,
                                      align = "center",
                                      headerStyle = list(background = "#f7f7f8")),
            # nsnp.90 = colDef(name = "90th Percentile", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.90 = colDef(name = "90th Percentile", align = "center",
                               headerStyle = list(background = "#f7f7f8"),
                          format = colFormat(digits = 5)),
            se.90 = colDef(name = "90th Percentile", align = "center",
                                headerStyle = list(background = "#f7f7f8"),
                           format = colFormat(digits = 5)),
             pval.90 = colDef(name = "90th Percentile", align = "center",
                                  headerStyle = list(background = "#f7f7f8"),
                              format = colFormat(digits = 5)
                              ),
            Adjusted.p.Cases99 = colDef(name = "99th Percentile", 
                                        align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.99 = colDef(name = "99th Percentile", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.99 = colDef(name = "99th Percentile", align = "center",
                               headerStyle = list(background = "#f7f7f8"),
                          format = colFormat(digits = 5)),
            se.99 = colDef(name = "99th Percentile", align = "center",
                                headerStyle = list(background = "#f7f7f8"),
                           format = colFormat(digits = 5)),
             pval.99 = colDef(name = "99th Percentile", align = "center",
                                  headerStyle = list(background = "#f7f7f8"),
                              format = colFormat(digits = 5)),
            Adjusted.p.Timmers = colDef(name = "Timmers", align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.timmers = colDef(name = "Timmers", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.timmers = colDef(name = "Timmers", align = "center",
                               headerStyle = list(background = "#f7f7f8"),
                               format = colFormat(digits = 5)),
            se.timmers = colDef(name = "Timmers", align = "center",
                                headerStyle = list(background = "#f7f7f8"),
                                format = colFormat(digits = 5)),
             pval.timmers =colDef(name = "Timmers", align = "center",
                                  headerStyle = list(background = "#f7f7f8"),
                                  format = colFormat(digits = 5)),
            Adjusted.p.Pilling = colDef(name = "Pilling", align = "center",
                                        headerStyle = list(background = "#f7f7f8"), 
                                        format = colFormat(digits = 5),
                                        style = function(value) {
                                          if (value <= 0.05) {
                                            color <- "#008000"
                                            } else if (value > 0.05) {
                                              color <- "#e00000"
                                              }
                                          list(color = color, fontWeight = "bold")
  }),
            # nsnp.pilling = colDef(name = "Pilling", align = "center",
            #                       headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            b.pilling = colDef(name = "Pilling", align = "center",
                               headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
             pval.pilling =colDef(name = "Pilling", align = "center",
                                 headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5)),
            
            se.pilling = colDef(name = "Pilling", align = "center",
                                headerStyle = list(background = "#f7f7f8"), format = colFormat(digits = 5))
  ),
  
            
          
            columnGroups = list(
              # colGroup(name = "nsnp", columns = c("nsnp.timmers", "nsnp.pilling", "nsnp.90", "nsnp.99")),
              colGroup(name = "Beta", columns = c("b.pilling", "b.timmers", "b.90", "b.99")),
              colGroup(name = "SE", columns = c("se.pilling", "se.timmers", "se.90", "se.99")),
              colGroup(name = "p-value", columns = c("pval.pilling", "pval.timmers", "pval.90", "pval.99")),
              colGroup(name = "Adjusted BH p-value", columns = c("Adjusted.p.Pilling", "Adjusted.p.Timmers", "Adjusted.p.Cases90", "Adjusted.p.Cases99"))
            ))
  # rowStyle = function(index) {
  #   if (table3[index, "Adjusted.p.Timmers"] >= 0.05)
  #     list(fontWeight = "bold", color = "#e00000")
  #   else if(table3[index, "Adjusted.p.Pilling"] <= 0.05)
  #     list(fontWeight = "bold")
  #   else if(table3[index, "Adjusted.p.Cases90"] <= 0.05)
  #     list(fontWeight = "bold")
  # 
  # }
  

```


        
# Conclusion

- lots of significant exposures
- mostly cardiovascular related



# Limitations and Next Steps


#Citations 
Stephen Burgess, Simon G Thompson, CRP CHD Genetics Collaboration, Avoiding bias from weak instruments in Mendelian randomization studies, International Journal of Epidemiology, Volume 40, Issue 3, June 2011, Pages 755–764, https://doi.org/10.1093/ije/dyr036


Davies NM, Holmes MV, Davey Smith G. Reading Mendelian randomisation studies: a guide, glossary, and checklist for clinicians. BMJ. 2018;362:k601. Published 2018 Jul 12. doi:10.1136/bmj.k601

Zheng, J., Baird, D., Borges, M. et al. Recent Developments in Mendelian Randomization Studies. Curr Epidemiol Rep 4, 330–345 (2017). https://doi.org/10.1007/s40471-017-0128-6
